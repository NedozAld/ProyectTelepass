<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador de Peajes</title>
    <link rel="stylesheet" href="../css/adm.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
</head>
<body>
<div class="container">
    <header class="header">
        <h1>Panel de Administración</h1>
        <nav class="nav-bar">
            <a href="#usuarios" data-section="usuarios">Gestión de Usuarios</a>
            <a href="#peajes" data-section="peajes">Gestión de Peajes</a>
            <a href="#vehiculos" data-section="vehiculos">Categoria Vehiculo</a>
            <a href="#tarifas" data-section="tarifas">Tarifa</a>
            <a href="#transacciones" data-section="transacciones">Transacciones</a>
            <a href="#pago-peaje" data-section="pago-peaje">Pago de Peaje</a>
            <!-- Otros enlaces omitidos por brevedad -->
            <a href="#index" id="salir">Salir</a>
        </nav>
    </header>
    <main class="main-content">
        <section id="usuarios" class="content-section" style="display: none;">
            <h2>Gestión de Usuarios</h2>
            <div class="table-container">
                <table id="usuariosTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombres</th>
                        <th>Apellidos</th>
                        <th>Cédula</th>
                        <th>Correo</th>
                        <th>Fecha de Nacimiento</th>
                        <th>Género</th>
                        <th>Role</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody id="usuariosTableBody">
                    <!-- Aquí se llenará dinámicamente -->
                    </tbody>
                </table>
                <p id="emptyMessage" style="display: none;">No hay información</p>
            </div>
        </section>
        <section id="peajes" class="content-section" style="display: none;">
            <h2>Gestión de Peajes</h2>
            <button id="btnMostrarFormCrearPeaje">Crear Nuevo Peaje</button>
            <div id="formCrearPeaje" style="display: none;">
                <h3>Crear Nueva Zona de Peaje</h3>
                <form id="crearPeajeForm">
                    <label for="nombrePeaje">Nombre de la Zona:</label>
                    <input type="text" id="nombrePeaje" name="nombrePeaje" required>
                    <button type="submit">Crear Zona</button>
                </form>
            </div>
            <div id="formActualizarPeaje" style="display: none;">
                <h3>Actualizar Zona de Peaje</h3>
                <form id="actualizarPeajeForm">
                    <input type="hidden" id="peajeIdActualizar" name="peajeIdActualizar">
                    <label for="nombrePeajeActualizar">Nombre de la Zona:</label>
                    <input type="text" id="nombrePeajeActualizar" name="nombrePeajeActualizar" required>
                    <button type="submit">Actualizar Zona</button>
                </form>
            </div>
            <div class="table-container">
                <table id="peajesTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Zona</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody id="peajesTableBody">
                    <!-- Aquí se llenará dinámicamente -->
                    </tbody>
                </table>
                <p id="emptyMessagePeajes" style="display: none;">No hay información de peajes</p>
            </div>
        </section>
        <section id="vehiculos" class="content-section" style="display: none;">
            <h2>Gestión de Categorías de Vehículos</h2>
            <button id="btnMostrarFormCrearVehiculoCategoria">Crear Nueva Categoría</button>
            <div id="formCrearVehiculoCategoria" style="display: none;">
                <h3>Crear Nueva Categoría de Vehículo</h3>
                <form id="crearVehiculoCategoriaForm">
                    <label for="nombreVehiculoCategoria">Nombre de la Categoría:</label>
                    <input type="text" id="nombreVehiculoCategoria" name="nombreVehiculoCategoria" required>
                    <button type="submit">Crear Categoría</button>
                </form>
            </div>
            <div id="formActualizarVehiculoCategoria" style="display: none;">
                <h3>Actualizar Categoría de Vehículo</h3>
                <form id="actualizarVehiculoCategoriaForm">
                    <input type="hidden" id="vehiculoCategoriaIdActualizar" name="vehiculoCategoriaIdActualizar">
                    <label for="nombreVehiculoCategoriaActualizar">Nombre de la Categoría:</label>
                    <input type="text" id="nombreVehiculoCategoriaActualizar" name="nombreVehiculoCategoriaActualizar" required>
                    <button type="submit">Actualizar Categoría</button>
                </form>
            </div>

            <div class="table-container">
                <table id="vehiculoCategoriasTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Categoría</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody id="vehiculoCategoriasTableBody">
                    <!-- Aquí se llenará dinámicamente -->
                    </tbody>
                </table>
                <p id="emptyMessageVehiculoCategorias" style="display: none;">No hay información de categorías</p>
            </div>
        </section>
        <section id="tarifas" class="content-section" style="display: none;">
            <h2>Gestión de Tarifas</h2>
            <button id="btnMostrarFormCrearTarifa">Crear Nueva Tarifa</button>
            <div id="formCrearTarifa" style="display: none;">
                <h3>Crear Nueva Tarifa</h3>
                <form id="crearTarifaForm">
                    <label for="montoTarifa">Monto:</label>
                    <input type="number" step="0.01" id="montoTarifa" name="montoTarifa" required>

                    <label for="vehiculoTarifa">Categoría de Vehículo:</label>
                    <select id="vehiculoTarifa" name="vehiculoTarifa" required>
                        <!-- Options will be populated dynamically -->
                    </select>

                    <label for="zonaTarifa">Zona:</label>
                    <select id="zonaTarifa" name="zonaTarifa" required>
                        <!-- Options will be populated dynamically -->
                    </select>

                    <button type="submit">Crear Tarifa</button>
                </form>
            </div>
            <div id="formActualizarTarifa" style="display: none;">
                <h3>Actualizar Tarifa</h3>
                <form id="actualizarTarifaForm">
                    <input type="hidden" id="tarifaIdActualizar" name="tarifaIdActualizar">

                    <label for="montoTarifaActualizar">Monto:</label>
                    <input type="number" step="0.01" id="montoTarifaActualizar" name="montoTarifaActualizar" required>

                    <label for="vehiculoTarifaActualizar">Categoría de Vehículo:</label>
                    <select id="vehiculoTarifaActualizar" name="vehiculoTarifaActualizar" required>
                        <!-- Options will be populated dynamically -->
                    </select>

                    <label for="zonaTarifaActualizar">Zona:</label>
                    <select id="zonaTarifaActualizar" name="zonaTarifaActualizar" required>
                        <!-- Options will be populated dynamically -->
                    </select>

                    <button type="submit">Actualizar Tarifa</button>
                </form>
            </div>
            <div class="table-container">
                <table id="tarifasTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Monto</th>
                        <th>Vehículo</th>
                        <th>Zona</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody id="tarifasTableBody">
                    <!-- Rows will be populated dynamically -->
                    </tbody>
                </table>
                <p id="emptyMessageTarifas" style="display: none;">No hay información de tarifas</p>
            </div>
        </section>
        <section id="transacciones" class="content-section" style="display: none;">
            <h2>Transacciones de Pagos</h2>
            <div class="table-container">
                <table id="transaccionesTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Usuario</th>
                        <th>Vehículo</th>
                        <th>Zona</th>
                        <th>Monto</th>
                        <th>Fecha de Pago</th>
                    </tr>
                    </thead>
                    <tbody id="transaccionesTableBody">
                    <!-- Aquí se llenará dinámicamente -->
                    </tbody>
                </table>
                <p id="emptyMessageTransacciones" style="display: none;">No hay transacciones de pagos</p>
            </div>
        </section>
        <section id="pago-peaje" class="content-section" style="display: none;">
            <h2>Pago de Peaje</h2>
            <div id="pagoForm">
                <form id="realizarPagoForm">
                    <label for="placaVehiculo">Placa del Vehículo:</label>
                    <input type="text" id="placaVehiculo" name="placaVehiculo" required>

                    <label for="zonaPeaje">Zona de Peaje:</label>
                    <select id="zonaPeaje" name="zonaPeaje" required>
                        <option value="" disabled selected>Seleccionar Zona de Peaje</option>
                        <!-- Options se cargarán dinámicamente -->
                    </select>
                </form>
            </div>
            <div id="resultadoTarifa" style="display: none;">
                <h3>Tarifa Efectiva:</h3>
                <input type="text" id="tarifaEfectiva" disabled>
                <button id="btnPagar" style="display: none;">Pagar</button>
            </div>
        </section>







        <!-- Otras secciones omitidas por brevedad -->
    </main>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('token');
        if (!token) {
            alert('No hay token de autenticación. Por favor, inicia sesión.');
            window.location.href = '/login.html'; // Redirige a la página de inicio de sesión
            return;
        }

        // Manejadores de eventos para los enlaces del menú
        const navLinks = document.querySelectorAll('.nav-bar a');
        navLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault(); // Evita el comportamiento predeterminado del enlace
                const sectionId = link.getAttribute('data-section');
                const section = document.getElementById(sectionId);

                // Ocultar todas las secciones menos la seleccionada
                const sections = document.querySelectorAll('.content-section');
                sections.forEach(sec => {
                    if (sec !== section) {
                        sec.style.display = 'none';
                    }
                });

                // Mostrar la sección correspondiente
                section.style.display = 'block';

                // Cargar datos si es necesario
                if (sectionId === 'usuarios') {
                    fetchUsuarios();
                } else if (sectionId === 'peajes') {
                    fetchPeajes();
                }else if (sectionId === 'vehiculos') {
                    fetchVehiculoCategorias();
                }else if (sectionId === 'tarifas') {
                    fetchTarifas();
                }else if (sectionId === 'transacciones') {
                    fetchTransacciones();
                }else if (sectionId === 'pago-peaje') {
                    cargarZonas();
                }

            });
        });



        // Función para cargar las zonas de peaje dinámicamente
        async function cargarZonas() {
            try {
                const response = await fetch('/api/zonas', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Error al obtener las zonas de peaje');
                }

                const data = await response.json();
                const zonaPeajeSelect = document.getElementById('zonaPeaje');

                // Limpiar opciones existentes
                zonaPeajeSelect.innerHTML = '<option value="" disabled selected>Seleccionar Zona de Peaje</option>';

                // Agregar opciones de zonas
                data.forEach(zona => {
                    const option = document.createElement('option');
                    option.value = zona.id;
                    option.textContent = zona.nombre;
                    zonaPeajeSelect.appendChild(option);
                });

                // Escuchar cambios en la selección de zona de peaje
                zonaPeajeSelect.addEventListener('change', async function() {
                    const placa = document.getElementById('placaVehiculo').value;
                    const zonaId = zonaPeajeSelect.value;

                    // Comprobar que placa y zonaId no sean nulos o vacíos antes de obtener la tarifa
                    if (placa && zonaId) {
                        try {
                            const response = await fetch(`/api/pagos/tarifaEfectivo?placa=${placa}&zonaId=${zonaId}`, {
                                headers: {
                                    'Authorization': `Bearer ${token}`,
                                    'Content-Type': 'application/json'
                                }
                            });

                            if (!response.ok) {
                                throw new Error('Error al obtener la tarifa efectiva');
                            }

                            const tarifa = await response.json();
                            const tarifaEfectivaInput = document.getElementById('tarifaEfectiva');
                            tarifaEfectivaInput.value = `${tarifa} USD`;
                            document.getElementById('resultadoTarifa').style.display = 'block';
                            document.getElementById('btnPagar').style.display = 'block';

                        } catch (error) {
                            console.error('Error al obtener la tarifa efectiva:', error);
                            alert('Hubo un problema al obtener la tarifa efectiva.');
                        }
                    } else {
                        // Si no se selecciona alguna de las dos (placa o zona), ocultar el resultado
                        document.getElementById('resultadoTarifa').style.display = 'none';
                        document.getElementById('btnPagar').style.display = 'none';
                    }
                });

            } catch (error) {
                console.error('Error al cargar las zonas de peaje:', error);
                alert('Hubo un problema al cargar las zonas de peaje.');
            }
        }

        // Función para realizar el pago efectivo
        async function realizarPagoEfectivo(placa, zonaId) {
            try {
                const response = await fetch(`/api/pagos/realizarPagoEfectivo?placa=${placa}&zonaId=${zonaId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Error al realizar el pago efectivo');
                }

                const pagoDTO = await response.json();
                console.log('Pago realizado con éxito:', pagoDTO);
                // Mostrar mensaje temporal de éxito con Sweet Alert
        Swal.fire({
            icon: 'success',
            title: 'Pago realizado con éxito',
            showConfirmButton: false, // Ocultar el botón de confirmación
            timer: 3000 // Tiempo en milisegundos antes de que se cierre automáticamente
        });



            } catch (error) {
                console.error('Error al realizar el pago efectivo:', error);
                alert('Hubo un problema al realizar el pago efectivo.');
            }
        }

        // Event listener para el botón Pagar
        document.getElementById('btnPagar').addEventListener('click', function() {
            const placa = document.getElementById('placaVehiculo').value;
            const zonaId = document.getElementById('zonaPeaje').value;

            if (placa && zonaId) {
                realizarPagoEfectivo(placa, zonaId);
                // Limpiar campos y ocultar sección de resultado
                document.getElementById('placaVehiculo').value = '';
                document.getElementById('zonaPeaje').value = '';
                document.getElementById('tarifaEfectiva').value = '';
                document.getElementById('resultadoTarifa').style.display = 'none';
                document.getElementById('btnPagar').style.display = 'none';
            } else {
                alert('Por favor seleccione una placa y una zona de peaje válidas.');
            }
        });



        // Mostrar formulario de creación de peaje al hacer clic en "Crear Nuevo Peaje"
        document.getElementById('btnMostrarFormCrearPeaje').addEventListener('click', function(event) {
            event.preventDefault();
            document.getElementById('formCrearPeaje').style.display = 'block';
            document.getElementById('formActualizarPeaje').style.display = 'none';
        });

        // Mostrar formulario de creación de categoría de vehículo al hacer clic en "Crear Nueva Categoría"
        document.getElementById('btnMostrarFormCrearVehiculoCategoria').addEventListener('click', function(event) {
            event.preventDefault();
            document.getElementById('formCrearVehiculoCategoria').style.display = 'block';
            document.getElementById('formActualizarVehiculoCategoria').style.display = 'none';
        });


        // Formulario para crear nueva zona de peaje
        document.getElementById('crearPeajeForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const nombrePeaje = document.getElementById('nombrePeaje').value;
            crearZona({ nombre: nombrePeaje });
            document.getElementById('formCrearPeaje').style.display = 'none';
        });
        // Formulario para crear nueva categoría de vehículo
        document.getElementById('crearVehiculoCategoriaForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const nombreCategoria = document.getElementById('nombreVehiculoCategoria').value;
            crearVehiculoCategoria({ tipo: nombreCategoria });
            document.getElementById('formCrearVehiculoCategoria').style.display = 'none';
             document.getElementById('nombreVehiculoCategoria').value = '';
        });

        // Formulario para actualizar zona de peaje
        document.getElementById('actualizarPeajeForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const peajeId = document.getElementById('peajeIdActualizar').value;
            const nombrePeaje = document.getElementById('nombrePeajeActualizar').value;
            actualizarZona(peajeId, { nombre: nombrePeaje });
            document.getElementById('formActualizarPeaje').style.display = 'none';
        });

        // Formulario para actualizar categoría de vehículo
        document.getElementById('actualizarVehiculoCategoriaForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const categoriaId = document.getElementById('vehiculoCategoriaIdActualizar').value;
            const nombreCategoria = document.getElementById('nombreVehiculoCategoriaActualizar').value;
            actualizarVehiculoCategoria(categoriaId, { tipo: nombreCategoria });
            document.getElementById('formActualizarVehiculoCategoria').style.display = 'none';
        });

        // Agregar manejo de eventos para los botones de acciones en la tabla de peajes
        document.getElementById('peajesTable').addEventListener('click', function(event) {
            const target = event.target;

            // Si se hace clic en el botón "Eliminar" de una fila
            if (target.matches('.btn-eliminar')) {
                const zonaId = target.dataset.peajeId;
                eliminarZona(zonaId);
            }

            // Si se hace clic en el botón "Editar" de una fila
            if (target.matches('.btn-editar')) {
                const zonaId = target.dataset.peajeId;
                const nombreZona = target.closest('tr').querySelector('td:nth-child(2)').textContent;
                document.getElementById('peajeIdActualizar').value = zonaId;
                document.getElementById('nombrePeajeActualizar').value = nombreZona;
                document.getElementById('formCrearPeaje').style.display = 'none';
                document.getElementById('formActualizarPeaje').style.display = 'block';
            }
        });

        // Agregar manejo de eventos para los botones de acciones en la tabla de categorías de vehículos
        document.getElementById('vehiculoCategoriasTable').addEventListener('click', function(event) {
            const target = event.target;

            // Si se hace clic en el botón "Eliminar" de una fila
            if (target.matches('.btn-eliminar')) {
                const categoriaId = target.dataset.vehiculoCategoriaId;
                eliminarVehiculoCategoria(categoriaId);
            }

            // Si se hace clic en el botón "Editar" de una fila
            if (target.matches('.btn-editar')) {
                const categoriaId = target.dataset.vehiculoCategoriaId;
                const nombreCategoria = target.closest('tr').querySelector('td:nth-child(2)').textContent;
                document.getElementById('vehiculoCategoriaIdActualizar').value = categoriaId;
                document.getElementById('nombreVehiculoCategoriaActualizar').value = nombreCategoria;
                document.getElementById('formCrearVehiculoCategoria').style.display = 'none';
                document.getElementById('formActualizarVehiculoCategoria').style.display = 'block';
            }
        });

        async function fetchUsuarios() {
            try {
                const response = await fetch('/api/usuario', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Error en la solicitud');
                }

                const data = await response.json();
                console.log('Usuarios recibidos:', data);
                const usuariosTableBody = document.getElementById('usuariosTableBody');
                const emptyMessage = document.getElementById('emptyMessage');

                usuariosTableBody.innerHTML = ''; // Limpiar contenido previo

                if (data.length === 0) {
                    emptyMessage.style.display = 'block';
                    return;
                }

                data.forEach(usuario => {
                    const row = usuariosTableBody.insertRow();
                    row.innerHTML = `
                        <td>${usuario.id}</td>
                        <td>${usuario.nombre}</td>
                        <td>${usuario.apellido}</td>
                        <td>${usuario.cedula}</td>
                        <td>${usuario.correo}</td>
                        <td>${usuario.fechaNacimiento}</td>
                        <td>${usuario.genero}</td>
                        <td>${usuario.role}</td>
                        <td>
                            <!-- Botones de acciones (editar, eliminar, etc.) -->
                        </td>
                    `;
                });

            } catch (error) {
                console.error('Error al obtener usuarios:', error);
                alert('Hubo un problema al cargar los usuarios.');
            }
        }

        async function fetchPeajes() {
            try {
                const response = await fetch('/api/zonas', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Error en la solicitud');
                }

                const data = await response.json();
                console.log('Peajes recibidos:', data);
                const peajesTableBody = document.getElementById('peajesTableBody');
                const emptyMessage = document.getElementById('emptyMessagePeajes');

                peajesTableBody.innerHTML = ''; // Limpiar contenido previo

                if (data.length === 0) {
                    emptyMessage.style.display = 'block';
                    return;
                }

                data.forEach(peaje => {
                    const row = peajesTableBody.insertRow();
                    row.innerHTML = `
                        <td>${peaje.id}</td>
                        <td>${peaje.nombre}</td>
                        <td>
                            <button class="btn-editar" data-peaje-id="${peaje.id}">Editar</button>
                            <button class="btn-eliminar" data-peaje-id="${peaje.id}">Eliminar</button>
                        </td>
                    `;
                });

            } catch (error) {
                console.error('Error al obtener peajes:', error);
                alert('Hubo un problema al cargar los peajes.');
            }
        }

        async function fetchVehiculoCategorias() {
            try {
                const response = await fetch('/api/vehiculo-categorias', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Error en la solicitud');
                }

                const data = await response.json();
                console.log('Categorías de vehículos recibidas:', data);
                const vehiculoCategoriasTableBody = document.getElementById('vehiculoCategoriasTableBody');
                const emptyMessage = document.getElementById('emptyMessageVehiculoCategorias');

                vehiculoCategoriasTableBody.innerHTML = ''; // Limpiar contenido previo

                if (data.length === 0) {
                    emptyMessage.style.display = 'block';
                    return;
                }

                data.forEach(categoria => {
                    const row = vehiculoCategoriasTableBody.insertRow();
                    row.innerHTML = `
                        <td>${categoria.id}</td>
                        <td>${categoria.tipo}</td>
                        <td>
                            <button class="btn-editar" data-vehiculo-categoria-id="${categoria.id}">Editar</button>
                            <button class="btn-eliminar" data-vehiculo-categoria-id="${categoria.id}">Eliminar</button>
                        </td>
                    `;
                });

            } catch (error) {
                console.error('Error al obtener categorías de vehículos:', error);
                alert('Hubo un problema al cargar las categorías de vehículos.');
            }
        }

        async function crearZona(zonaData) {
            try {
                const response = await fetch('/api/zonas/crear', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(zonaData)
                });

                if (!response.ok) {
                    throw new Error('Error al crear la zona');
                }

                const nuevaZona = await response.json();
                console.log('Zona creada:', nuevaZona);
                fetchPeajes(); // Actualizar la tabla de peajes después de crear
            } catch (error) {
                console.error('Error al crear la zona:', error);
                alert('Hubo un problema al crear la zona.');
            }
        }



        async function actualizarZona(zonaId, zonaData) {
            try {
                const response = await fetch(`/api/zonas/actualizar/${zonaId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(zonaData)
                });

                if (!response.ok) {
                    throw new Error('Error al actualizar la zona');
                }

                const zonaActualizada = await response.json();
                console.log('Zona actualizada:', zonaActualizada);
                fetchPeajes(); // Actualizar la tabla de peajes después de actualizar
            } catch (error) {
                console.error('Error al actualizar la zona:', error);
                alert('Hubo un problema al actualizar la zona.');
            }
        }

        async function eliminarZona(zonaId) {
            try {
                const response = await fetch(`/api/zonas/eliminar/${zonaId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Error al eliminar la zona');
                }

                console.log('Zona eliminada con éxito');
                fetchPeajes(); // Actualizar la tabla de peajes después de eliminar
            } catch (error) {
                console.error('Error al eliminar la zona:', error);
                alert('Hubo un problema al eliminar la zona.');
            }
        }
 async function crearVehiculoCategoria(categoriaData) {
            try {
                const response = await fetch('/api/vehiculo-categorias/crear', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(categoriaData)
                });

                if (!response.ok) {
                    throw new Error('Error al crear la categoría de vehículo');
                }

                const nuevaCategoria = await response.json();
                console.log('Categoría de vehículo creada:', nuevaCategoria);
                fetchVehiculoCategorias(); // Actualizar la tabla de categorías de vehículos después de crear
            } catch (error) {
                console.error('Error al crear la categoría de vehículo:', error);
                alert('Hubo un problema al crear la categoría de vehículo.');
            }
        }


        async function actualizarVehiculoCategoria(categoriaId, categoriaData) {
            try {
            console.log(categoriaId);
            console.log(categoriaData);
                const response = await fetch(`/api/vehiculo-categorias/actualizar/${categoriaId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(categoriaData)
                });

                if (!response.ok) {
                    throw new Error('Error al actualizar la categoría de vehículo');
                }

                const categoriaActualizada = await response.json();
                console.log('Categoría de vehículo actualizada:', categoriaActualizada);
                fetchVehiculoCategorias(); // Actualizar la tabla de categorías de vehículos después de actualizar
            } catch (error) {
                console.error('Error al actualizar la categoría de vehículo:', error);
                alert('Hubo un problema al actualizar la categoría de vehículo.');
            }
        }

        async function eliminarVehiculoCategoria(categoriaId) {
            try {
                const response = await fetch(`/api/vehiculo-categorias/eliminar/${categoriaId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Error al eliminar la categoría de vehículo');
                }

                console.log('Categoría de vehículo eliminada con éxito');
                fetchVehiculoCategorias(); // Actualizar la tabla de categorías de vehículos después de eliminar
            } catch (error) {
                console.error('Error al eliminar la categoría de vehículo:', error);
                alert('Hubo un problema al eliminar la categoría de vehículo.');
            }
        }

        // Tarifas
        document.getElementById('btnMostrarFormCrearTarifa').addEventListener('click', function(event) {
    event.preventDefault();
    document.getElementById('formCrearTarifa').style.display = 'block';
    document.getElementById('formActualizarTarifa').style.display = 'none';
    fetchVehiculoCategoriasLis('vehiculoTarifa'); // Populate vehicle categories
    fetchZonasLis('zonaTarifa'); // Populate zones
});

        // Formulario para crear nueva tarifa
    document.getElementById('crearTarifaForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const montoTarifa = document.getElementById('montoTarifa').value;
        const vehiculoTarifa = document.getElementById('vehiculoTarifa').value;
        const zonaTarifa = document.getElementById('zonaTarifa').value;

        const tarifaData = {
            monto: montoTarifa,
            vehiculoId: vehiculoTarifa,
            zonaId: zonaTarifa
        };

        crearTarifa(tarifaData);
        document.getElementById('formCrearTarifa').style.display = 'none';
    });

    // Formulario para actualizar tarifa
    document.getElementById('actualizarTarifaForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const tarifaId = document.getElementById('tarifaIdActualizar').value;
        const montoTarifa = document.getElementById('montoTarifaActualizar').value;
        const vehiculoTarifa = document.getElementById('vehiculoTarifaActualizar').value;
        const zonaTarifa = document.getElementById('zonaTarifaActualizar').value;

        const tarifaData = {
            monto: montoTarifa,
            vehiculoId: vehiculoTarifa,
            zonaId: zonaTarifa
        };

        actualizarTarifa(tarifaId, tarifaData);
        document.getElementById('formActualizarTarifa').style.display = 'none';
    });

    // Agregar manejo de eventos para los botones de acciones en la tabla de tarifas
    document.getElementById('tarifasTable').addEventListener('click', function(event) {
        const target = event.target;

        // Si se hace clic en el botón "Eliminar" de una fila
        if (target.matches('.btn-eliminar')) {
            const tarifaId = target.dataset.tarifaId;
            eliminarTarifa(tarifaId);
        }

        // Si se hace clic en el botón "Editar" de una fila
        if (target.matches('.btn-editar')) {
            const tarifaId = target.dataset.tarifaId;
            const montoTarifa = target.closest('tr').querySelector('td:nth-child(2)').textContent;
            const vehiculoTarifa = target.closest('tr').querySelector('td:nth-child(3)').textContent;
            const zonaTarifa = target.closest('tr').querySelector('td:nth-child(4)').textContent;

            document.getElementById('tarifaIdActualizar').value = tarifaId;
            document.getElementById('montoTarifaActualizar').value = montoTarifa;
            fetchVehiculoCategoriasLis('vehiculoTarifaActualizar', vehiculoTarifa); // Populate vehicle categories with current value
            fetchZonasLis('zonaTarifaActualizar', zonaTarifa); // Populate zones with current value
            document.getElementById('formCrearTarifa').style.display = 'none';
            document.getElementById('formActualizarTarifa').style.display = 'block';
        }
    });

    async function fetchTarifas() {
        try {
            const response = await fetch('/api/tarifas', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Error en la solicitud');
            }

            const data = await response.json();
            console.log('Tarifas recibidas:', data);
            const tarifasTableBody = document.getElementById('tarifasTableBody');
            const emptyMessage = document.getElementById('emptyMessageTarifas');

            tarifasTableBody.innerHTML = ''; // Limpiar contenido previo

            if (data.length === 0) {
                emptyMessage.style.display = 'block';
                return;
            }

            data.forEach(tarifa => {
                const row = tarifasTableBody.insertRow();
                row.innerHTML = `
                    <td>${tarifa.id}</td>
                    <td>${tarifa.monto}</td>
                    <td>${tarifa.vehiculo}</td>
                    <td>${tarifa.zona}</td>
                    <td>
                        <button class="btn-editar" data-tarifa-id="${tarifa.id}">Editar</button>
                        <button class="btn-eliminar" data-tarifa-id="${tarifa.id}">Eliminar</button>
                    </td>
                `;
            });

        } catch (error) {
            console.error('Error al obtener tarifas:', error);
            alert('Hubo un problema al cargar las tarifas.');
        }
    }

    async function crearTarifa(tarifaData) {
        try {
            const response = await fetch('/api/tarifas/crear', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(tarifaData)
            });

            if (!response.ok) {
                throw new Error('Error al crear la tarifa');
            }

            const nuevaTarifa = await response.json();
            console.log('Tarifa creada:', nuevaTarifa);
            fetchTarifas(); // Actualizar la tabla de tarifas después de crear
        } catch (error) {
            console.error('Error al crear la tarifa:', error);
            alert('Hubo un problema al crear la tarifa.');
        }
    }

    async function actualizarTarifa(tarifaId, tarifaData) {
        try {
            const response = await fetch(`/api/tarifas/actualizar/${tarifaId}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(tarifaData)
            });

            if (!response.ok) {
                throw new Error('Error al actualizar la tarifa');
            }

            const tarifaActualizada = await response.json();
            console.log('Tarifa actualizada:', tarifaActualizada);
            fetchTarifas(); // Actualizar la tabla de tarifas después de actualizar
        } catch (error) {
            console.error('Error al actualizar la tarifa:', error);
            alert('Hubo un problema al actualizar la tarifa.');
        }
    }

    async function eliminarTarifa(tarifaId) {
        try {
            const response = await fetch(`/api/tarifas/eliminar/${tarifaId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Error al eliminar la tarifa');
            }

            console.log('Tarifa eliminada');
            fetchTarifas(); // Actualizar la tabla de tarifas después de eliminar
        } catch (error) {
            console.error('Error al eliminar la tarifa:', error);
            alert('Hubo un problema al eliminar la tarifa.');
        }
    }

    async function fetchVehiculoCategoriasLis(selectId, selectedValue) {
        try {
            const response = await fetch('/api/vehiculo-categorias', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Error en la solicitud');
            }

            const data = await response.json();
            const selectElement = document.getElementById(selectId);

            selectElement.innerHTML = ''; // Limpiar opciones previas
            data.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria.id;
                option.text = categoria.tipo;
                selectElement.add(option);
            });

            if (selectedValue) {
                selectElement.value = selectedValue;
            }

        } catch (error) {
            console.error('Error al obtener categorías de vehículos:', error);
            alert('Hubo un problema al cargar las categorías de vehículos.');
        }
    }

    async function fetchZonasLis(selectId, selectedValue) {
        try {
            const response = await fetch('/api/zonas', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Error en la solicitud');
            }

            const data = await response.json();
            const selectElement = document.getElementById(selectId);

            selectElement.innerHTML = ''; // Limpiar opciones previas
            data.forEach(zona => {
                const option = document.createElement('option');
                option.value = zona.id;
                option.text = zona.nombre;
                selectElement.add(option);
            });

            if (selectedValue) {
                selectElement.value = selectedValue;
            }

        } catch (error) {
            console.error('Error al obtener zonas:', error);
            alert('Hubo un problema al cargar las zonas.');
        }
    }

    //Transacciones
    async function fetchTransacciones() {
        try {
            const response = await fetch('/api/pagos', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Error en la solicitud');
            }

            const data = await response.json();
            console.log('Transacciones recibidas:', data);
            const transaccionesTableBody = document.getElementById('transaccionesTableBody');
            const emptyMessage = document.getElementById('emptyMessageTransacciones');

            transaccionesTableBody.innerHTML = '';

            if (data.length === 0) {
                emptyMessage.style.display = 'block';
                return;
            }

            data.forEach(transaccion => {
                const row = transaccionesTableBody.insertRow();
                row.innerHTML = `
                    <td>${transaccion.id}</td>
                     <td>${transaccion.usuario}</td>
                    <td>${transaccion.vehiculo}</td>
                    <td>${transaccion.zona}</td>
                    <td>${transaccion.monto}</td>
                    <td>${transaccion.fechaPago}</td>
                `;
            });

        } catch (error) {
            console.error('Error al obtener transacciones:', error);
            alert('Hubo un problema al cargar las transacciones de pagos.');
        }
    }




    });
</script>
</body>
</html>
