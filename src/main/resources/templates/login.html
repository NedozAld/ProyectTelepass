<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="../css/login.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
</head>
<body>
<section class="home show">
    <div class="form_container">
        <i class="uil uil-times form_close"></i>
        <div class="form login-form">
            <form id="login-form">
                <h2>Hola Bienvenido!</h2>
                <div class="input_box">
                    <input id="login-username" type="email" name="username" placeholder="Ingresa tu email" required>
                    <i class="uil uil-envelope-alt email"></i>
                </div>
                <div class="input_box">
                    <input id="login-password" type="password" name="password" placeholder="Ingresa tu Contrase単a" required>
                    <i class="uil uil-lock password"></i>
                    <i class="uil uil-eye-slash pw_hide"></i>
                </div>
                <div class="option_field">
                    <span class="checkbox">
                        <input type="checkbox" id="check">
                        <label for="check">Recordarme</label>
                    </span>
                    <a href="recuperarEmail" class="forgot_pw">多Olvidaste tu contrase単a?</a>
                </div>
                <button type="submit" class="button">Iniciar Sesion</button>
                <div class="login_signup">多No tienes cuenta? <a href="registro" id="signup">Registrar</a></div>
            </form>
        </div>
    </div>
</section>
<script>
    document.getElementById('login-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevenir el comportamiento por defecto del formulario
        authenticateUser();
    });

    async function authenticateUser() {
        const correo = document.getElementById('login-username').value;
        const contrasena = document.getElementById('login-password').value;

        const response = await fetch('/api/auth/authenticate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ correo, contrasena })
        });
    
        if (response.ok) {
            const data = await response.json();
            const token = data.token;
            const usuarioId = data.id;
            console.log(usuarioId)
            localStorage.setItem('token', token);// Guardar el token en localStorage
            localStorage.setItem("usuarioId", usuarioId)
            alert('Authentication successful!');
            window.location.href = '/dashboard';
        } else {
            alert('Failed to authenticate user');
        }
}

</script>
</body>
</html>
